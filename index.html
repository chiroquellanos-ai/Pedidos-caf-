<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Registration - Candy Style</title>
     <link rel="manifest" href="manifest.json">
     <meta name="theme-color" content="#000000">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(45deg, #ff9a56, #ffdb4d, #4dd0e1);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .app-container {
            max-width: 600px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-conic-gradient(from 0deg, transparent 0deg, rgba(255,255,255,0.1) 10deg, transparent 20deg);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .music-control {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
        }

        .google-docs-control {
            position: absolute;
            top: 10px;
            left: 70px;
            z-index: 100;
        }

        .whatsapp-control {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
        }

        .control-button {
            border: none;
            border-radius: 12px;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 
                8px 8px 16px rgba(0, 0, 0, 0.3),
                -8px -8px 16px rgba(255, 255, 255, 0.4),
                inset 3px 3px 6px rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .google-docs-button {
            background: linear-gradient(145deg, #4285f4, #1a73e8);
            box-shadow: 
                8px 8px 16px rgba(66, 133, 244, 0.3),
                -8px -8px 16px rgba(255, 255, 255, 0.4),
                inset 3px 3px 6px rgba(255, 255, 255, 0.2),
                inset -3px -3px 6px rgba(66, 133, 244, 0.7);
        }

        .whatsapp-button {
            background: linear-gradient(145deg, #25d366, #128c7e);
            box-shadow: 
                8px 8px 16px rgba(37, 211, 102, 0.3),
                -8px -8px 16px rgba(255, 255, 255, 0.4),
                inset 3px 3px 6px rgba(255, 255, 255, 0.2),
                inset -3px -3px 6px rgba(37, 211, 102, 0.7);
        }

        .control-button:hover {
            transform: scale(1.1) rotateY(10deg);
            box-shadow: 
                12px 12px 24px rgba(0, 0, 0, 0.4),
                -12px -12px 24px rgba(255, 255, 255, 0.6);
        }

        .control-button:active {
            transform: scale(0.95);
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.4),
                inset -6px -6px 12px rgba(255, 255, 255, 0.1);
        }

        .export-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(145deg, #34a853, #137333);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 
                0 8px 16px rgba(52, 168, 83, 0.4),
                inset 0 -4px 8px rgba(0, 0, 0, 0.2),
                inset 0 4px 8px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 100;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .export-button:hover {
            transform: scale(1.1) rotateZ(-5deg);
            box-shadow: 
                0 12px 24px rgba(52, 168, 83, 0.6),
                inset 0 -6px 12px rgba(0, 0, 0, 0.3),
                inset 0 6px 12px rgba(255, 255, 255, 0.4);
        }

        .export-button:active {
            transform: scale(0.95);
            box-shadow: 
                inset 0 6px 12px rgba(52, 168, 83, 0.4),
                inset 0 -6px 12px rgba(255, 255, 255, 0.1);
        }

        .music-button {
            background: linear-gradient(145deg, #4dd0e1, #26c6da);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 
                8px 8px 16px rgba(77, 208, 225, 0.3),
                -8px -8px 16px rgba(255, 255, 255, 0.4),
                inset 3px 3px 6px rgba(255, 255, 255, 0.2),
                inset -3px -3px 6px rgba(77, 208, 225, 0.7);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .music-button:hover {
            transform: scale(1.1) rotateY(10deg);
            box-shadow: 
                12px 12px 24px rgba(77, 208, 225, 0.4),
                -12px -12px 24px rgba(255, 255, 255, 0.6);
        }

        .music-button:active {
            transform: scale(0.95);
            box-shadow: 
                inset 6px 6px 12px rgba(77, 208, 225, 0.4),
                inset -6px -6px 12px rgba(255, 255, 255, 0.1);
        }

        .screen {
            padding: 30px 20px;
            text-align: center;
            min-height: 400px;
        }

        .screen.hidden {
            display: none;
        }

        .screen h2 {
            color: #ff6b35;
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .button-grid {
            display: grid;
            gap: 20px;
            margin: 20px 0;
        }

        .screen1 .button-grid {
            grid-template-columns: 1fr;
            max-width: 400px;
            margin: 20px auto;
        }

        .screen2 .button-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        .candy-button {
            background: linear-gradient(145deg, #ffdb4d, #f7931e, #ff6b35);
            border: none;
            border-radius: 25px;
            padding: 20px;
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
            box-shadow: 
                0 12px 24px rgba(247, 147, 30, 0.4),
                0 6px 12px rgba(255, 107, 53, 0.3),
                inset 0 -6px 12px rgba(0, 0, 0, 0.2),
                inset 0 6px 12px rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid rgba(255, 255, 255, 0.2);
            transform-style: preserve-3d;
        }

        .candy-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            transition: left 0.6s;
        }

        .candy-button::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            height: 40%;
            background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(255,255,255,0.1));
            border-radius: 20px;
            pointer-events: none;
        }

        .candy-button:hover::before {
            left: 100%;
        }

        .candy-button:hover {
            transform: translateY(-8px) scale(1.05) rotateX(5deg);
            box-shadow: 
                0 20px 40px rgba(247, 147, 30, 0.6),
                0 10px 20px rgba(255, 107, 53, 0.4),
                inset 0 -8px 16px rgba(0, 0, 0, 0.3),
                inset 0 8px 16px rgba(255, 255, 255, 0.4);
        }

        .candy-button:active {
            transform: translateY(-4px) scale(1.02) rotateX(2deg);
            box-shadow: 
                0 8px 16px rgba(247, 147, 30, 0.4),
                0 4px 8px rgba(255, 107, 53, 0.3),
                inset 0 -4px 8px rgba(0, 0, 0, 0.4),
                inset 0 4px 8px rgba(255, 255, 255, 0.2);
        }

        .candy-button.orange {
            background: linear-gradient(145deg, #ff6b35, #f7931e, #ffdb4d);
            box-shadow: 
                0 12px 24px rgba(255, 107, 53, 0.4),
                0 6px 12px rgba(247, 147, 30, 0.3),
                inset 0 -6px 12px rgba(0, 0, 0, 0.2),
                inset 0 6px 12px rgba(255, 255, 255, 0.3);
        }

        .candy-button.orange:hover {
            box-shadow: 
                0 20px 40px rgba(255, 107, 53, 0.6),
                0 10px 20px rgba(247, 147, 30, 0.4),
                inset 0 -8px 16px rgba(0, 0, 0, 0.3),
                inset 0 8px 16px rgba(255, 255, 255, 0.4);
        }

        .candy-button.cyan {
            background: linear-gradient(145deg, #4dd0e1, #26c6da, #00bcd4);
            box-shadow: 
                0 12px 24px rgba(77, 208, 225, 0.4),
                0 6px 12px rgba(38, 198, 218, 0.3),
                inset 0 -6px 12px rgba(0, 0, 0, 0.2),
                inset 0 6px 12px rgba(255, 255, 255, 0.3);
        }

        .candy-button.cyan:hover {
            box-shadow: 
                0 20px 40px rgba(77, 208, 225, 0.6),
                0 10px 20px rgba(38, 198, 218, 0.4),
                inset 0 -8px 16px rgba(0, 0, 0, 0.3),
                inset 0 8px 16px rgba(255, 255, 255, 0.4);
        }

        .candy-button.whatsapp {
            background: linear-gradient(145deg, #25d366, #128c7e, #075e54);
            box-shadow: 
                0 12px 24px rgba(37, 211, 102, 0.4),
                0 6px 12px rgba(18, 140, 126, 0.3),
                inset 0 -6px 12px rgba(0, 0, 0, 0.2),
                inset 0 6px 12px rgba(255, 255, 255, 0.3);
        }

        .candy-button.whatsapp:hover {
            box-shadow: 
                0 20px 40px rgba(37, 211, 102, 0.6),
                0 10px 20px rgba(18, 140, 126, 0.4),
                inset 0 -8px 16px rgba(0, 0, 0, 0.3),
                inset 0 8px 16px rgba(255, 255, 255, 0.4);
        }

        .form-container {
            display: grid;
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .input-group {
            position: relative;
        }

        .candy-input {
            width: 100%;
            padding: 15px 20px;
            border: 4px solid #ffdb4d;
            border-radius: 25px;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 
                inset 0 4px 8px rgba(0, 0, 0, 0.1),
                0 4px 8px rgba(255, 219, 77, 0.2);
        }

        .candy-input:focus {
            border-color: #ff6b35;
            transform: scale(1.02) translateY(-2px);
            box-shadow: 
                inset 0 6px 12px rgba(0, 0, 0, 0.1),
                0 8px 16px rgba(255, 107, 53, 0.3);
        }

        .candy-input::placeholder {
            color: #999;
        }

        /* Checkbox personalizado para estado de pago */
        .checkbox-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 10px 0;
        }

        .checkbox-container {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-container input[type="checkbox"] {
            opacity: 0;
            position: absolute;
        }

        .checkbox-custom {
            width: 30px;
            height: 30px;
            border: 4px solid #ffdb4d;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            position: relative;
            margin-right: 10px;
            transition: all 0.3s ease;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(255, 219, 77, 0.2);
        }

        .checkbox-container input[type="checkbox"]:checked + .checkbox-custom {
            background: linear-gradient(145deg, #4CAF50, #45a049);
            border-color: #4CAF50;
            transform: scale(1.1);
        }

        .checkbox-container input[type="checkbox"]:checked + .checkbox-custom::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        .checkbox-label {
            font-size: 1.1rem;
            color: #333;
            font-weight: bold;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: linear-gradient(145deg, #4dd0e1, #26c6da);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 
                0 8px 16px rgba(77, 208, 225, 0.4),
                inset 0 -4px 8px rgba(0, 0, 0, 0.2),
                inset 0 4px 8px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 10;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .back-button:hover {
            transform: scale(1.1) rotateY(-10deg);
            box-shadow: 
                0 12px 24px rgba(77, 208, 225, 0.6),
                inset 0 -6px 12px rgba(0, 0, 0, 0.3),
                inset 0 6px 12px rgba(255, 255, 255, 0.4);
        }

        .back-button:active {
            transform: scale(0.95);
            box-shadow: 
                inset 0 6px 12px rgba(77, 208, 225, 0.4),
                inset 0 -6px 12px rgba(255, 255, 255, 0.1);
        }

        .summary {
            background: linear-gradient(135deg, rgba(255, 219, 77, 0.2), rgba(77, 208, 225, 0.2));
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 3px solid #ffdb4d;
            box-shadow: 
                0 8px 16px rgba(255, 219, 77, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }

        .summary h3 {
            color: #ff6b35;
            margin-bottom: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 107, 53, 0.2);
            align-items: center;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .payment-status {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .paid-badge {
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .unpaid-badge {
            background: linear-gradient(145deg, #ff4444, #cc0000);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .orders-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            padding: 0 10px;
        }

        .order-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 219, 77, 0.1));
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ffdb4d;
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.1),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.15),
                inset 0 2px 4px rgba(255, 255, 255, 0.4);
        }

        .delete-order-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(145deg, #ff4444, #cc0000);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 
                0 4px 8px rgba(255, 68, 68, 0.3),
                inset 0 -2px 4px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .delete-order-btn:hover {
            transform: scale(1.1) rotateZ(5deg);
            box-shadow: 
                0 6px 12px rgba(255, 68, 68, 0.5),
                inset 0 -3px 6px rgba(0, 0, 0, 0.3),
                inset 0 3px 6px rgba(255, 255, 255, 0.4);
        }

        .delete-order-btn:active {
            transform: scale(0.95);
            box-shadow: 
                inset 0 3px 6px rgba(255, 68, 68, 0.4),
                inset 0 -3px 6px rgba(255, 255, 255, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 219, 77, 0.1));
            margin: 15% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            border: 2px solid #ffdb4d;
            text-align: center;
        }

        .modal h3 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .modal-input {
            width: 100%;
            padding: 15px;
            border: 3px solid;
            border-radius: 15px;
            font-size: 1rem;
            margin: 10px 0;
            outline: none;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .modal-input:focus {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.2),
                inset 0 -3px 6px rgba(0, 0, 0, 0.1),
                inset 0 3px 6px rgba(255, 255, 255, 0.3);
        }

        .modal-btn.save {
            background: linear-gradient(145deg, #4285f4, #1a73e8);
            color: white;
        }

        .modal-btn.save-whatsapp {
            background: linear-gradient(145deg, #25d366, #128c7e);
            color: white;
        }

        .modal-btn.cancel {
            background: linear-gradient(145deg, #999, #666);
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                inset 0 -4px 8px rgba(0, 0, 0, 0.1),
                inset 0 4px 8px rgba(255, 255, 255, 0.4);
        }

        .order-number {
            font-weight: bold;
            color: #ff6b35;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .view-orders-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(145deg, #ff6b35, #f7931e);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 
                0 8px 16px rgba(255, 107, 53, 0.4),
                inset 0 -4px 8px rgba(0, 0, 0, 0.2),
                inset 0 4px 8px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 100;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .view-orders-btn:hover {
            transform: scale(1.1) rotateZ(5deg);
            box-shadow: 
                0 12px 24px rgba(255, 107, 53, 0.6),
                inset 0 -6px 12px rgba(0, 0, 0, 0.3),
                inset 0 6px 12px rgba(255, 255, 255, 0.4);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .app-container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 15px;
            }
            
            .screen {
                padding: 20px 15px;
                min-height: 350px;
            }
            
            .button-grid {
                gap: 15px;
            }
            
            .candy-button {
                padding: 15px;
                min-height: 70px;
            }

            .whatsapp-control {
                left: 10px;
            }

            .google-docs-control {
                left: 70px;
            }
        }

        @media (max-width: 480px) {
            .screen2 .button-grid {
                grid-template-columns: 1fr;
            }
            
            .view-orders-btn {
                bottom: 10px;
                right: 10px;
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .whatsapp-control {
                top: 70px;
                left: 10px;
            }

            .google-docs-control {
                top: 70px;
                left: 70px;
            }
        }

        /* Coffee bean animation */
        .coffee-beans {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .coffee-bean {
            position: absolute;
            width: 20px;
            height: 30px;
            background: #8B4513;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 15s infinite linear;
        }

        .coffee-bean::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 20px;
            background: #654321;
            border-radius: 2px;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.1;
            }
            90% {
                opacity: 0.1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        
    </style>
</head>
<body>
    <!-- WhatsApp Control -->
    <div class="whatsapp-control">
        <button class="control-button whatsapp-button" id="whatsappBtn" onclick="showWhatsAppModal()" title="Configurar WhatsApp">üí¨</button>
    </div>

    <!-- Google Docs Control -->
    <div class="google-docs-control">
        <button class="control-button google-docs-button" id="googleDocsBtn" onclick="showGoogleDocsModal()" title="Configurar Google Docs">üìÑ</button>
    </div>

    <!-- Music Control -->
    <div class="music-control">
        <button class="music-button" id="musicToggle" onclick="toggleMusic()">üéµ</button>
    </div>

    <div class="app-container">
        <div class="header">
            <h1>‚òï Coffee Registration</h1>
        </div>
        
        <!-- Screen 1: Coffee Type Selection -->
        <div class="screen screen1" id="screen1">
            <h2>Selecciona el tipo de caf√©</h2>
            <div class="button-grid">
                <button class="candy-button orange" onclick="selectCoffeeType('Tostado')">
                    üî• Tostado
                </button>
                <button class="candy-button" onclick="selectCoffeeType('Molido')">
                    ‚ö° Molido
                </button>
                <button class="candy-button cyan" onclick="selectCoffeeType('Tostado-Molido')">
                    üåü Tostado-Molido
                </button>
            </div>
        </div>
        
        <!-- Screen 2: Grind Type Selection (only for Tostado-Molido) -->
    
       
<div class="screen screen2 hidden" id="screen2">
    <button class="back-button" onclick="goBack(1)">‚Üê</button>
    <h2>Selecciona el tipo de molido</h2>
    <div class="button-grid">
        <button class="candy-button orange" onclick="selectGrindType('Fino-Tetera')">
            ‚òï Fino-Tetera
        </button>
        <button class="candy-button cyan" onclick="selectGrindType('Pasar-Cafetera')">
            ‚öñÔ∏è Pasar-Cafetera
        </button>
    </div>
</div>

        
        <!-- Screen 3: Details Form -->
        <div class="screen screen3 hidden" id="screen3">
            <button class="back-button" onclick="goBack()">‚Üê</button>
            <h2>Detalles del pedido</h2>
            <div class="form-container">
                <div class="input-group">
                    <input type="text" class="candy-input" id="customerName" placeholder="Nombre del cliente" required>
                </div>
                <div class="input-group">
                    <input type="tel" class="candy-input" id="phoneNumber" placeholder="N√∫mero de tel√©fono" required>
                </div>
                <div class="input-group">
                    <input type="text" class="candy-input" id="deliveryTime" placeholder="Tiempo de entrega (ej: 2 d√≠as)" required>
                </div>
                <div class="input-group">
                    <input type="number" class="candy-input" id="weight" placeholder="Peso en KG" min="0.1" step="0.1" required>
                </div>
                
                <div class="input-group">
                    <select class="candy-input" id="bagType" required>
                        <option value="" disabled selected>Selecciona el tipo de bolsa</option>
                        <option value="250">Peque√±o (250 g)</option>
                        <option value="500">Mediano (500 g)</option>
                        <option value="2000">Grande (2000 g)</option>
                    </select>
                </div>

                <div class="checkbox-group">
                    <div class="checkbox-container">
                        <input type="checkbox" id="isPaid">
                        <div class="checkbox-custom"></div>
                        <label for="isPaid" class="checkbox-label">üí≥ ¬øPagado?</label>
                    </div>
                </div>
                <button class="candy-button orange" onclick="submitOrder()" style="margin-top: 20px;">
                    ‚úÖ Registrar Pedido
                </button>
            </div>
        </div>
        
        <!-- Screen 4: Summary -->
        <div class="screen screen4 hidden" id="screen4">
            <h2>¬°Pedido Registrado!</h2>
            <div class="summary" id="orderSummary">
                <!-- Summary will be populated by JavaScript -->
            </div>
            <button class="candy-button cyan" onclick="newOrder()" style="margin-top: 20px;">
                üÜï Nuevo Pedido
            </button>
            <button class="candy-button whatsapp" onclick="sendToWhatsApp()" style="margin-top: 10px;">
                üì± Enviar a WhatsApp
            </button>
        </div>
        
        <!-- Screen 5: View All Orders -->
        <div class="screen screen5 hidden" id="screen5">
            <button class="back-button" onclick="showScreen(1)">‚Üê</button>
            <h2>üìã Pedidos Guardados</h2>
            <div class="orders-list" id="ordersList">
                <p style="color: #999; text-align: center;">No hay pedidos guardados a√∫n</p>
            </div>
            <button class="candy-button orange" onclick="clearAllOrders()" style="margin-top: 20px;">
                üóëÔ∏è Limpiar Todos
            </button>
        </div>
        
        <div class="coffee-beans" id="coffeeBeansContainer"></div>
    </div>

    <!-- Export to Google Docs Button -->
    <button class="export-button" onclick="exportToGoogleDocs()" title="Exportar a Google Docs">üìä</button>

    <!-- View Orders Button -->
    <button class="view-orders-btn" onclick="viewAllOrders()" title="Ver pedidos guardados">
        üìã
    </button>

    <!-- Google Docs Configuration Modal -->
    <div id="googleDocsModal" class="modal">
        <div class="modal-content">
            <h3 style="color: #4285f4;">üìÑ Configurar Google Docs</h3>
            <p style="color: #666; margin-bottom: 20px;">Ingresa la URL de tu Google Docs para exportar los pedidos:</p>
            <input type="url" id="googleDocsUrl" class="modal-input" placeholder="https://docs.google.com/document/d/..." value="" style="border-color: #4285f4;">
            <p style="font-size: 0.9rem; color: #999; margin: 10px 0;">
                üí° Aseg√∫rate de que el documento tenga permisos de edici√≥n
            </p>
            <div class="modal-buttons">
                <button class="modal-btn save" onclick="saveGoogleDocsUrl()">üíæ Guardar</button>
                <button class="modal-btn cancel" onclick="closeGoogleDocsModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- WhatsApp Configuration Modal -->
    <div id="whatsappModal" class="modal">
        <div class="modal-content">
            <h3 style="color: #25d366;">üí¨ Configurar WhatsApp</h3>
            <p style="color: #666; margin-bottom: 20px;">Ingresa la URL de tu grupo de WhatsApp:</p>
            <input type="url" id="whatsappUrl" class="modal-input" placeholder="https://chat.whatsapp.com/..." value="" style="border-color: #25d366;">
            <p style="font-size: 0.9rem; color: #999; margin: 10px 0;">
                üí° Tambi√©n puedes usar un n√∫mero de tel√©fono: +51987654321
            </p>
            <input type="text" id="whatsappPhone" class="modal-input" placeholder="+51987654321 (opcional)" style="border-color: #25d366;">
            <div class="modal-buttons">
                <button class="modal-btn save-whatsapp" onclick="saveWhatsAppUrl()">üíæ Guardar</button>
                <button class="modal-btn cancel" onclick="closeWhatsAppModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Application state
      // Application state
let currentScreen = 1;
let orderData = {
    coffeeType: '',
    grindType: '',
    customerName: '',
    phoneNumber: '',
    deliveryTime: '',
    weight: '',
    isPaid: false
};

// Ya no usamos localStorage para pedidos: los pedimos al servidor
let savedOrders = [];      // se llenar√° desde /api/orders cuando se pida
let orderCounter = null;   // el servidor asigna el id
let googleDocsUrl = localStorage.getItem('googleDocsUrl') || '';
let whatsappUrl = localStorage.getItem('whatsappUrl') || '';
let whatsappPhone = localStorage.getItem('whatsappPhone') || '';
let musicPlaying = false;
let currentTrack = 0;
let lastOrderData = null; // Para guardar el √∫ltimo pedido registrado

// API base: si est√°s en localhost usa http://localhost:3000, si est√°s ya sirviendo la web desde el mismo host usa origin.
const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
  ? 'http://localhost:3000'
  : window.location.origin;


        // Music tracks (simple melodies using Web Audio API)
        const musicTracks = [
            { name: "Happy Melody", frequency: [523, 587, 659, 698, 784, 880, 988] },
            { name: "Upbeat Tune", frequency: [440, 494, 523, 587, 659, 740, 831] },
            { name: "Cheerful Beat", frequency: [659, 698, 784, 831, 880, 988, 1047] },
            { name: "Candy Theme", frequency: [784, 880, 988, 1047, 1175, 1319, 1480] }
        ];

        let audioContext;
        let currentOscillator;

        // Initialize audio context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Play simple melody
        function playMelody(trackIndex) {
            if (!audioContext) return;
            
            const track = musicTracks[trackIndex];
            let noteIndex = 0;
            
            function playNote() {
                if (!musicPlaying || noteIndex >= track.frequency.length) {
                    if (musicPlaying) {
                        noteIndex = 0;
                        setTimeout(playNote, 500); // Pause between loops
                    }
                    return;
                }
                
                // Stop previous note
                if (currentOscillator) {
                    currentOscillator.stop();
                }
                
                // Create new note
                currentOscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                currentOscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                currentOscillator.frequency.setValueAtTime(track.frequency[noteIndex], audioContext.currentTime);
                currentOscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                currentOscillator.start(audioContext.currentTime);
                currentOscillator.stop(audioContext.currentTime + 0.3);
                
                noteIndex++;
                setTimeout(playNote, 350);
            }
            
            playNote();
        }

        function toggleMusic() {
            initAudio();
            
            const button = document.getElementById('musicToggle');
            
            if (musicPlaying) {
                musicPlaying = false;
                if (currentOscillator) {
                    currentOscillator.stop();
                }
                button.innerHTML = 'üîá';
                button.style.opacity = '0.6';
            } else {
                musicPlaying = true;
                button.innerHTML = 'üéµ';
                button.style.opacity = '1';
                playMelody(currentTrack);
                
                // Cycle through tracks
                setInterval(() => {
                    if (musicPlaying) {
                        currentTrack = (currentTrack + 1) % musicTracks.length;
                    }
                }, 15000); // Change track every 15 seconds
            }
        }

        // Initialize coffee beans animation
        function createCoffeeBeans() {
            const container = document.getElementById('coffeeBeansContainer');
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const bean = document.createElement('div');
                    bean.className = 'coffee-bean';
                    bean.style.left = Math.random() * 100 + '%';
                    bean.style.animationDelay = Math.random() * 15 + 's';
                    bean.style.animationDuration = (15 + Math.random() * 10) + 's';
                    container.appendChild(bean);
                    
                    // Remove bean after animation
                    setTimeout(() => {
                        if (bean.parentNode) {
                            bean.parentNode.removeChild(bean);
                        }
                    }, 25000);
                }, i * 3000);
            }
        }

        // Start coffee beans animation
        setInterval(createCoffeeBeans, 10000);
        createCoffeeBeans();

        function showScreen(screenNumber) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // Show target screen
            document.getElementById(`screen${screenNumber}`).classList.remove('hidden');
            currentScreen = screenNumber;
        }

        function selectCoffeeType(type) {
            orderData.coffeeType = type;
            
            if (type === 'Tostado-Molido') {
                showScreen(2);
            } else {
                orderData.grindType = ''; // Reset grind type for non-mixed coffee
                showScreen(3);
            }
        }

        function selectGrindType(type) {
            orderData.grindType = type;
            showScreen(3);
        }

        function goBack(targetScreen) {
            if (targetScreen) {
                showScreen(targetScreen);
            } else {
                if (currentScreen === 3) {
                    if (orderData.coffeeType === 'Tostado-Molido') {
                        showScreen(2);
                    } else {
                        showScreen(1);
                    }
                } else if (currentScreen === 2) {
                    showScreen(1);
                }
            }
        }

        //Funcion submit Order


        async function submitOrder() {
  const name = document.getElementById('customerName').value.trim();
  const phone = document.getElementById('phoneNumber').value.trim();
  const time = document.getElementById('deliveryTime').value.trim();
  const weight = document.getElementById('weight').value.trim();
  const isPaid = document.getElementById('isPaid').checked;
  const bagType = document.getElementById('bagType').value;

  if (!name || !phone || !time || !weight) {
    alert("Completa todos los campos");
    return;
  }

  const newOrderPayload = {
    coffeeType: orderData.coffeeType,
    grindType: orderData.grindType,
    customerName: name,
    phoneNumber: phone,
    deliveryTime: time,
    weight: weight,
    isPaid: isPaid,
    bagType: bagType
  };

  try {
    const res = await fetch(`${API_BASE}/api/orders`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(newOrderPayload)
    });

    if (!res.ok) throw new Error('Respuesta no OK del servidor');

    const createdOrder = await res.json();
    lastOrderData = createdOrder;

//tipo de bolsa 

const bagType = document.getElementById('bagType').value;
if (!bagType) {
  alert("Selecciona el tipo de bolsa");
  return;
}


    // Actualizamos la vista de resumen usando el pedido que nos devolvi√≥ el servidor
    displayOrderSummary(createdOrder);
    showScreen(4);

  } catch (err) {
    console.error(err);
    alert('Error al guardar el pedido: ' + (err.message || err));
  }
}

    //DisplayOrderSummary

function displayOrderSummary(order = null) {
  const o = order || lastOrderData || orderData;
  const summary = document.getElementById('orderSummary');

  let summaryHTML = `
    <h3>Resumen del Pedido #${o.id || ''}</h3>
    <div class="summary-item">
      <span><strong>Cliente:</strong></span>
      <span>${o.customerName}</span>
    </div>
    <div class="summary-item">
      <span><strong>Tel√©fono:</strong></span>
      <span>${o.phoneNumber}</span>
    </div>
    <div class="summary-item">
      <span><strong>Tipo de Caf√©:</strong></span>
      <span>${o.coffeeType}</span>
    </div>
  `;

  if (o.grindType) {
    summaryHTML += `
      <div class="summary-item">
        <span><strong>Tipo de Molido:</strong></span>
        <span>${o.grindType}</span>
      </div>
    `;
  }

  summaryHTML += `
    <div class="summary-item">
      <span><strong>Tiempo de Entrega:</strong></span>
      <span>${o.deliveryTime}</span>
    </div>
    <div class="summary-item">
      <span><strong>Peso:</strong></span>
      <span>${o.weight} KG</span>
    </div>
    <div class="summary-item">
      <span><strong>Estado de Pago:</strong></span>
      <span class="payment-status">
        ${o.isPaid ? '<span class="paid-badge">‚úÖ Pagado</span>' : '<span class="unpaid-badge">‚ùå Pendiente</span>'}
      </span>
    </div>
    <div class="summary-item">
      <span><strong>Fecha de Registro:</strong></span>
      <span>${o.timestamp || new Date().toLocaleString()}</span>
    </div>
  `;

  summary.innerHTML = summaryHTML;
}





        // WhatsApp Functions
        function showWhatsAppModal() {
            const modal = document.getElementById('whatsappModal');
            const urlInput = document.getElementById('whatsappUrl');
            const phoneInput = document.getElementById('whatsappPhone');
            urlInput.value = whatsappUrl;
            phoneInput.value = whatsappPhone;
            modal.style.display = 'block';
        }

        function closeWhatsAppModal() {
            const modal = document.getElementById('whatsappModal');
            modal.style.display = 'none';
        }

        function saveWhatsAppUrl() {
            const urlInput = document.getElementById('whatsappUrl');
            const phoneInput = document.getElementById('whatsappPhone');
            const url = urlInput.value.trim();
            const phone = phoneInput.value.trim();
            
            if (!url && !phone) {
                alert('Por favor, ingresa al menos una URL de grupo o un n√∫mero de tel√©fono');
                return;
            }
            
            if (url && !url.includes('chat.whatsapp.com') && !url.includes('wa.me')) {
                alert('Por favor, ingresa una URL v√°lida de WhatsApp');
                return;
            }
            
            whatsappUrl = url;
            whatsappPhone = phone;
            localStorage.setItem('whatsappUrl', whatsappUrl);
            localStorage.setItem('whatsappPhone', whatsappPhone);
            closeWhatsAppModal();
            
            updateWhatsAppButton();
            
            if (url || phone) {
                alert('‚úÖ WhatsApp configurado correctamente');
            } else {
                alert('‚ùå Configuraci√≥n de WhatsApp eliminada');
            }
        }

        function sendToWhatsApp() {
            if (!whatsappUrl && !whatsappPhone) {
                alert('‚ö†Ô∏è Primero debes configurar WhatsApp.\nHaz clic en el bot√≥n üí¨ en la esquina superior izquierda.');
                return;
            }
            
            if (!lastOrderData) {
                alert('No hay pedido para enviar');
                return;
            }
            
            // Crear mensaje formateado para WhatsApp
            let message = `üî• *NUEVO PEDIDO DE CAF√â* ‚òï\n\n`;
            message += `üìã *Pedido #${lastOrderData.id}*\n`;
            message += `üë§ *Cliente:* ${lastOrderData.customerName}\n`;
            message += `üìû *Tel√©fono:* ${lastOrderData.phoneNumber}\n`;
            message += `‚òï *Tipo de caf√©:* ${lastOrderData.coffeeType}\n`;
            
            if (lastOrderData.grindType) {
                message += `‚ö° *Tipo de molido:* ${lastOrderData.grindType}\n`;
            }
            
            message += `‚è∞ *Tiempo de entrega:* ${lastOrderData.deliveryTime}\n`;
            message += `‚öñÔ∏è *Peso:* ${lastOrderData.weight} KG\n`;
            message += `üõçÔ∏è *Bolsa:* ${lastOrderData.bagType}\n`; 
            message += `üí≥ *Estado de pago:* ${lastOrderData.isPaid ? '‚úÖ Pagado' : '‚ùå Pendiente'}\n`;
            message += `üìÖ *Registrado:* ${lastOrderData.timestamp}`;
            
            // Codificar mensaje para URL
            const encodedMessage = encodeURIComponent(message);
            
            let whatsappLink = '';
            
            if (whatsappPhone) {
                // Limpiar n√∫mero de tel√©fono
                const cleanPhone = whatsappPhone.replace(/\D/g, '');
                whatsappLink = `https://wa.me/${cleanPhone}?text=${encodedMessage}`;
            } else if (whatsappUrl) {
                // Si es un enlace de grupo, usar la API de WhatsApp Web
                if (whatsappUrl.includes('chat.whatsapp.com')) {
                    // Para grupos, abrir primero el grupo y luego el mensaje
                    whatsappLink = whatsappUrl;
                    // Despu√©s de abrir el grupo, se copiar√° el mensaje al portapapeles
                } else {
                    whatsappLink = whatsappUrl + (whatsappUrl.includes('?') ? '&' : '?') + `text=${encodedMessage}`;
                }
            }
            
            if (whatsappLink) {
                // Copiar mensaje al portapapeles como respaldo
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(message).then(() => {
                        console.log('Mensaje copiado al portapapeles');
                    });
                }
                
                // Abrir WhatsApp
                window.open(whatsappLink, '_blank');
                
                if (whatsappUrl && whatsappUrl.includes('chat.whatsapp.com')) {
                    // Para grupos, mostrar instrucciones adicionales
                    setTimeout(() => {
                        alert('üì± Se ha abierto el grupo de WhatsApp.\n\nüí° El mensaje tambi√©n se copi√≥ al portapapeles.\n\nPega el mensaje (Ctrl+V o Cmd+V) en el chat.');
                    }, 1000);
                } else {
                    alert('üì± ¬°Mensaje enviado a WhatsApp!');
                }
            } else {
                alert('‚ùå Error al generar enlace de WhatsApp');
            }
        }

        function updateWhatsAppButton() {
            const btn = document.getElementById('whatsappBtn');
            if (whatsappUrl || whatsappPhone) {
                btn.style.background = 'linear-gradient(145deg, #25d366, #075e54)';
                btn.title = 'WhatsApp configurado ‚úÖ';
            } else {
                btn.style.background = 'linear-gradient(145deg, #25d366, #128c7e)';
                btn.title = 'Configurar WhatsApp';
            }
        }

async function viewAllOrders() {
  try {
    const res = await fetch(`${API_BASE}/api/orders`);
    if (!res.ok) throw new Error('No se pudieron obtener pedidos');
    const orders = await res.json();

    const ordersList = document.getElementById('ordersList');
    if (!orders || orders.length === 0) {
      ordersList.innerHTML = '<p style="color: #999; text-align: center;">No hay pedidos guardados a√∫n</p>';
      showScreen(5);
      return;
    }

    // Construir tarjetas; el bot√≥n de eliminar ahora usar√° el id del pedido
    let ordersHTML = '';
    orders.forEach((order) => {
      ordersHTML += `
        <div class="order-card">
          <button class="delete-order-btn" onclick="deleteOrder(${order.id})" title="Eliminar pedido">üóëÔ∏è</button>
          <div class="order-number">Pedido #${order.id}</div>
          <div class="summary-item"><span><strong>Cliente:</strong></span><span>${order.customerName}</span></div>
          <div class="summary-item"><span><strong>Tel√©fono:</strong></span><span>${order.phoneNumber}</span></div>
          <div class="summary-item"><span><strong>Tipo:</strong></span><span>${order.coffeeType}</span></div>
          ${order.grindType ? `<div class="summary-item"><span><strong>Molido:</strong></span><span>${order.grindType}</span></div>` : ''}
          <div class="summary-item"><span><strong>Entrega:</strong></span><span>${order.deliveryTime}</span></div>
          <div class="summary-item"><span><strong>Peso:</strong></span><span>${order.weight} KG</span></div>
          <div class="summary-item"><span><strong>Pago:</strong></span><span class="payment-status">${order.isPaid ? '<span class="paid-badge">‚úÖ Pagado</span>' : '<span class="unpaid-badge">‚ùå Pendiente</span>'}</span></div>
          <div class="summary-item"><span><strong>Registrado:</strong></span><span>${order.timestamp}</span></div>
        </div>
      `;
    });

    ordersList.innerHTML = ordersHTML;
    showScreen(5);

  } catch (err) {
    console.error(err);
    alert('Error cargando pedidos: ' + (err.message || err));
  }
}

async function deleteOrder(id) {
  if (!confirm('¬øEst√°s seguro de que quieres eliminar este pedido?')) return;

  try {
    const res = await fetch(`${API_BASE}/api/orders/${id}`, { method: 'DELETE' });
    if (!res.ok) throw new Error('No se pudo eliminar pedido');
    // refrescar lista
    await viewAllOrders();
  } catch (err) {
    console.error(err);
    alert('Error eliminando pedido: ' + (err.message || err));
  }
}



async function clearAllOrders() {
  // Confirmaci√≥n igual que antes
  if (!confirm('¬øEst√°s seguro de que quieres eliminar todos los pedidos?')) return;

  try {
    const res = await fetch(`${API_BASE}/api/orders`, { method: 'DELETE' });
    if (!res.ok) throw new Error('No se pudieron eliminar los pedidos');
    await viewAllOrders();
    alert('Todos los pedidos han sido eliminados');
  } catch (err) {
    console.error(err);
    alert('Error limpiando pedidos: ' + (err.message || err));
  }
}

        function showGoogleDocsModal() {
            const modal = document.getElementById('googleDocsModal');
            const urlInput = document.getElementById('googleDocsUrl');
            urlInput.value = googleDocsUrl;
            modal.style.display = 'block';
        }

        function closeGoogleDocsModal() {
            const modal = document.getElementById('googleDocsModal');
            modal.style.display = 'none';
        }

        function saveGoogleDocsUrl() {
            const urlInput = document.getElementById('googleDocsUrl');
            const url = urlInput.value.trim();
            
            if (url && !url.includes('docs.google.com')) {
                alert('Por favor, ingresa una URL v√°lida de Google Docs');
                return;
            }
            
            googleDocsUrl = url;
            localStorage.setItem('googleDocsUrl', googleDocsUrl);
            closeGoogleDocsModal();
            
            updateGoogleDocsButton();
            
            if (url) {
                alert('‚úÖ URL de Google Docs configurada correctamente');
            } else {
                alert('‚ùå URL de Google Docs eliminada');
            }
        }


async function exportToGoogleDocs() {
  if (!googleDocsUrl) {
    alert('‚ö†Ô∏è Primero debes configurar la URL de Google Docs.\nHaz clic en el bot√≥n üìÑ en la esquina superior izquierda.');
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/api/orders`);
    if (!res.ok) throw new Error('No se pudieron obtener pedidos para exportar');
    const orders = await res.json();

    if (!orders || orders.length === 0) {
      alert('No hay pedidos para exportar');
      return;
    }

    let exportText = `REPORTE DE PEDIDOS DE CAF√â\n`;
    exportText += `=====================================\n`;
    exportText += `Fecha de exportaci√≥n: ${new Date().toLocaleString()}\n`;
    exportText += `Total de pedidos: ${orders.length}\n\n`;

    orders.forEach((order) => {
      exportText += `PEDIDO #${order.id}\n`;
      exportText += `----------------------------------------\n`;
      exportText += `Cliente: ${order.customerName}\n`;
      exportText += `Tel√©fono: ${order.phoneNumber}\n`;
      exportText += `Tipo de caf√©: ${order.coffeeType}\n`;
      if (order.grindType) exportText += `Tipo de molido: ${order.grindType}\n`;
      exportText += `Tiempo de entrega: ${order.deliveryTime}\n`;
      exportText += `Peso: ${order.weight} KG\n`;
      exportText += `Bolsa: ${order.bagType}\n`;
      exportText += `Estado de pago: ${order.isPaid ? 'Pagado' : 'Pendiente'}\n`;
      exportText += `Fecha de registro: ${order.timestamp}\n\n`;
    });

    // Copiar y abrir como antes
    if (navigator.clipboard) {
      await navigator.clipboard.writeText(exportText);
      alert(`üìã ¬°Pedidos copiados al portapapeles!\n\nAhora ve a tu Google Docs y pega el contenido (Ctrl+V o Cmd+V).\n\nüîó Tu documento: ${googleDocsUrl}`);
      window.open(googleDocsUrl, '_blank');
    } else {
      showExportText(exportText);
    }

  } catch (err) {
    console.error(err);
    alert('Error exportando pedidos: ' + (err.message || err));
  }
}




        function showExportText(text) {
            // Create a temporary textarea for copying text
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert(`üìã ¬°Pedidos copiados al portapapeles!\n\nAhora ve a tu Google Docs y pega el contenido (Ctrl+V o Cmd+V).\n\nüîó Tu documento: ${googleDocsUrl}`);
                window.open(googleDocsUrl, '_blank');
            } catch (err) {
                document.body.removeChild(textarea);
                alert('‚ùå No se pudo copiar autom√°ticamente.\n\nPor favor, copia manualmente el texto desde la consola del navegador.');
                console.log('TEXTO PARA EXPORTAR:\n', text);
            }
        }

        function newOrder() {
            // Reset order data
            orderData = {
                coffeeType: '',
                grindType: '',
                customerName: '',
                phoneNumber: '',
                deliveryTime: '',
                weight: '',
                isPaid: false
            };
            
            // Clear form inputs
            document.getElementById('customerName').value = '';
            document.getElementById('phoneNumber').value = '';
            document.getElementById('deliveryTime').value = '';
            document.getElementById('weight').value = '';
            document.getElementById('isPaid').checked = false;
            
            // Return to first screen
            showScreen(1);
        }

        function updateGoogleDocsButton() {
            const btn = document.getElementById('googleDocsBtn');
            if (googleDocsUrl) {
                btn.style.background = 'linear-gradient(145deg, #34a853, #137333)';
                btn.title = 'Google Docs configurado ‚úÖ';
            } else {
                btn.style.background = 'linear-gradient(145deg, #4285f4, #1a73e8)';
                btn.title = 'Configurar Google Docs';
            }
        }

        // Add some interactive feedback
        document.addEventListener('DOMContentLoaded', function() {
            // Add click sound effect (visual feedback)
            document.querySelectorAll('.candy-button').forEach(button => {
                button.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 100);
                });
            });

            // Initialize music button
            const musicButton = document.getElementById('musicToggle');
            musicButton.innerHTML = 'üîá';
            musicButton.style.opacity = '0.6';
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                const googleModal = document.getElementById('googleDocsModal');
                const whatsappModal = document.getElementById('whatsappModal');
                
                if (event.target === googleModal) {
                    closeGoogleDocsModal();
                }
                
                if (event.target === whatsappModal) {
                    closeWhatsAppModal();
                }
            };
            
            // Update button appearances
            updateGoogleDocsButton();
            updateWhatsAppButton();
        });

        // Handle page visibility for music
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && musicPlaying) {
                // Pause music when tab is not visible
                if (currentOscillator) {
                    currentOscillator.stop();
                }
            }
        });
    </script>
    <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js")
      .then(reg => console.log("Service Worker registrado", reg))
      .catch(err => console.log("Error al registrar el Service Worker", err));
  }
</script>

</body>

</html>
